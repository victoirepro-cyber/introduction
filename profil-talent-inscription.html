<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Inscription - Profil Talent</title>

<style>
  *{ box-sizing:border-box; }
  body{ margin:0; font-family: Arial, sans-serif; background:#ffffff; }

  /* Zone globale */
  .screen{
    min-height:100vh;
    display:flex;
    background: linear-gradient(to right, #ffffff 0%, #ffffff 30%, #a8c2da 100%);
  }

  /* Menu gauche */
  .sidebar{
    width:220px;
    padding:0;
    min-height:100vh;
    display:flex;
    flex-direction:column;
    background:#fff;
  }

  .logo img{
    max-width:220px;
    height:auto;
    display:block;
  }

  .menu{
    background-color:#fff;
    flex:1;
    padding:20px;
    border: 1.5px solid #2f5fa7;
    border-radius: 10px;
  }

  .menu a{
    display:block;
    margin:35px 0;
    text-decoration:none;
    color:black;
    font-style:italic;
  }

  .menu a:hover{color:red}

  .menu a.active{
    font-size:22px;
    font-weight:bold;
    color:red;
  }

  .dropdown{position:relative;margin:20px 0;}

  .dropbtn{
    display:block;
    text-decoration:none;
    color:black;
    font-style:italic;
  }

  .dropbtn:hover{color:red;}

  .dropdown-content{
    display:none;
    margin-top:8px;
    margin-left:12px;
    border-left:2px solid #eee;
    padding-left:12px;
  }

  .dropdown-content a{
    display:block;
    margin:10px 0;
    text-decoration:none;
    color:#333;
    font-style:normal;
    font-size:14px;
  }

  .dropdown-content a:hover{color:red;}
  .dropdown:hover .dropdown-content{display:block;}

  /* Zone contenu */
  .content{
    flex:1;
    padding:30px 22px;
  }

  .title{
    text-align:center;
    color:#b71c1c;
    font-size:34px;
    letter-spacing:1px;
    margin:18px 0 10px;
    font-weight:500;
  }

  .subtitle{
    text-align:center;
    margin:0 0 20px;
    font-size:16px;
    color:#111;
    font-weight:700;
  }

  .badge{
    display:inline-block;
    padding:6px 10px;
    border-radius:999px;
    border:1.5px solid #2f5fa7;
    font-size:13px;
    font-weight:700;
    background:#fff;
  }

  /* Formulaire centré */
  .form-area{
    max-width:980px;
    margin:0 auto;
    padding-top:10px;
  }

  .section{
    background:#ffffff;
    border:1.5px solid #2f5fa7;
    border-radius:12px;
    padding:18px 16px;
    margin:16px 0;
  }

  .section h3{
    margin:0 0 12px;
    font-size:20px;
    color:#2f5fa7;
  }

  .hint{
    margin:0 0 12px;
    font-size:14px;
    line-height:1.35;
    color:#333;
  }

  .row{
    display:grid;
    grid-template-columns: 260px 1fr;
    gap:20px;
    align-items:center;
    margin:14px 0;
  }

  .row label{
    font-size:18px;
    font-weight:700;
    color:#111;
  }

  .row input[type="text"],
  .row input[type="password"],
  .row input[type="email"],
  .row input[type="date"],
  .row input[type="number"],
  .row select,
  .row textarea{
    height:45px;
    width:100%;
    border:2px solid #9e9e9e;
    background:#ffffff;
    padding:10px 12px;
    outline:none;
    font-family:inherit;
  }

  .row textarea{
    height:90px;
    resize:vertical;
  }

  .labelline{
    display:flex;
    align-items:center;
    gap:10px;
    flex-wrap:wrap;
  }

  .tag-modif{
    display:none;
    font-size:12px;
    font-weight:800;
    color:#b71c1c;
    border:1px solid #b71c1c;
    padding:3px 8px;
    border-radius:999px;
  }

  .inline{
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
    width:100%;
  }

  /* Onglets */
  .tabs{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin:8px 0 0;
  }
  .tabbtn{
    border:1.5px solid #2f5fa7;
    background:#fff;
    color:#2f5fa7;
    font-weight:900;
    border-radius:999px;
    padding:8px 12px;
    cursor:pointer;
    font-size:13px;
  }
  .tabbtn.active{
    background:#2f5fa7;
    color:#fff;
  }
  .tabpanel{
    display:none;
    margin-top:14px;
    padding-top:12px;
    border-top:1px dashed #cfd8dc;
  }
  .tabpanel.active{ display:block; }

  .card{
    border:1px solid #e0e0e0;
    border-radius:10px;
    padding:12px;
    margin:10px 0;
    background:#fafafa;
  }

  /* Boutons */
  .actions{
    margin-top:14px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
  }

  .btn-primary{
    width:300px;
    height:46px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-size:18px;
    font-weight:800;
    color:#fff;
    background:#2f5fa7;
  }
  .btn-primary:hover{ filter:brightness(0.95); }

  .btn-secondary{
    width:300px;
    height:46px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-size:16px;
    font-weight:800;
    color:#fff;
    background:#777;
  }

  .btn-small{
    height:38px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-size:14px;
    font-weight:800;
    color:#fff;
    background:#2f5fa7;
    padding:0 14px;
  }
  .btn-small.gray{ background:#777; }
  .btn-small.red{ background:#b71c1c; }

  /* Message feedback */
  .msg{
    margin-top:8px;
    text-align:center;
    font-size:16px;
    font-weight:800;
  }
  .msg.ok{ color:#1b5e20; }
  .msg.err{ color:#b71c1c; }

  /* Ligne "Déjà inscrit" */
  .already{
    margin-top:10px;
    text-align:center;
    font-size:16px;
    font-weight:700;
  }
  .already a{
    color:#1565c0;
    text-decoration:underline;
  }

  .note{
    margin-top:10px;
    padding:10px 12px;
    border-radius:10px;
    background:#fff;
    border:1px solid #e0e0e0;
    font-size:13px;
    line-height:1.35;
  }

  @media (max-width: 900px){
    .screen{ flex-direction:column; }
    .sidebar{ width:100%; }
    .row{ grid-template-columns:1fr; }
  }
</style>
</head>

<body>
  <div class="screen">

    <!-- MENU GAUCHE -->
    <div class="sidebar">
      <div class="logo">
        <img src="images/LOGO I-JOM.jpg" alt="Logo I-JOM">
      </div>

      <div class="menu">
        <a href="index.html">ACCUEIL</a>
        <a href="apropos.html">A PROPOS DE NOUS</a>

        <!-- PROFIL TALENT (dropdown) -->
        <div class="dropdown">
          <span class="dropbtn active">PROFIL TALENT ▾</span>
          <div class="dropdown-content">
            <a href="profil-talent-connexion.html">Connexion</a>
            <a href="profil-talent-compte.html">Mon Compte</a>
            <a href="profil-talent-inscription.html" class="active">Inscription</a>
          </div>
        </div>

        <!-- RECRUTEUR (dropdown) -->
        <div class="dropdown">
          <span class="dropbtn">RECRUTEUR ▾</span>
          <div class="dropdown-content">
            <a href="recruteur-connexion.html">Connexion</a>
            <a href="recruteur-moncompte.html">Mon Compte</a>
            <a href="recruteur-inscription.html">Inscription</a>
          </div>
        </div>

        <a href="partenaires.html">NOS PARTENAIRES</a>
        <a href="contact.html">NOUS CONTACTER</a>
      </div>
    </div>

    <!-- CONTENU -->
    <main class="content">
      <div class="title">INSCRIPTION PROFIL TALENT</div>
      <p class="subtitle">
        <span class="badge" id="modeBadge">Mode : Création de compte</span>
      </p>

      <div class="form-area">
        <form id="signupForm" action="#" method="post" novalidate>

          <!-- ✅ PARTIE 1 : Accès direct au compte -->
          <div class="section">
            <h3>1) Accès direct au compte</h3>
            <p class="hint">
              Création de compte : <b>adresse mail</b>, <b>login</b>, <b>mot de passe</b>.<br>
              Si vous êtes déjà connecté(e), vous pouvez modifier (selon les règles).
            </p>

            <div class="row">
              <div class="labelline">
                <label for="email">Adresse mail</label>
                <span class="tag-modif" id="tagEmail">MODIFIER</span>
              </div>
              <input id="email" name="email" type="email" autocomplete="email" required placeholder="ex: nom.prenom@email.com">
            </div>

            <div class="row">
              <div class="labelline">
                <label for="login">Login</label>
                <span class="tag-modif" id="tagLogin">MODIFIER</span>
              </div>
              <input id="login" name="login" type="text" autocomplete="username" required placeholder="Choisissez un login">
            </div>

            <!-- Création -->
            <div class="row" id="rowPwdCreate">
              <div class="labelline">
                <label for="mdp">Mot de passe</label>
                <span class="tag-modif" id="tagMdp">MODIFIER</span>
              </div>
              <input id="mdp" name="password" type="password" autocomplete="new-password" required placeholder="Choisissez un mot de passe">
            </div>

            <!-- Modification : mot de passe en astérisques + bouton modifier -->
            <div class="row" id="rowPwdModify" style="display:none;">
              <div class="labelline">
                <label>Mot de passe</label>
                <span class="tag-modif" style="display:inline-block;">MODIFIER</span>
              </div>
              <div class="inline">
                <input type="password" value="********" disabled style="flex:1;">
                <button type="button" class="btn-small red" id="btnChangePwd">Modifier</button>
              </div>
            </div>

            <div class="actions">
              <button type="submit" class="btn-primary" id="btnSubmit">Créer mon compte</button>
              <button type="button" class="btn-secondary" id="btnGoAccount" style="display:none;">Aller à Mon Compte</button>
              <div class="msg" id="msg" aria-live="polite"></div>
            </div>

            <div class="already">
              Déjà inscrit(e) ? <a href="profil-talent-connexion.html">Se connecter</a>
            </div>
          </div>

          <!-- ✅ PARTIE 2 : Enregistrement profil -->
          <div class="section">
            <h3>2) Enregistrement des informations du profil</h3>

            <div class="tabs" role="tablist">
              <button type="button" class="tabbtn active" data-tab="identite">IDENTITE</button>
              <button type="button" class="tabbtn" data-tab="formation">FORMATION</button>
              <button type="button" class="tabbtn" data-tab="experiences">EXPERIENCES PROFESSIONNELLES</button>
              <button type="button" class="tabbtn" data-tab="langues">APTITUDES LINGUISTIQUE</button>
              <button type="button" class="tabbtn" data-tab="handicap">HANDICAP</button>
            </div>

            <!-- IDENTITE -->
            <div class="tabpanel active" id="tab-identite">
              <div class="row"><label>Nom</label><input id="nom" type="text"></div>
              <div class="row"><label>Prénom</label><input id="prenom" type="text"></div>
              <div class="row"><label>Emploi / Poste actuel</label><input id="posteActuel" type="text"></div>

              <div class="row">
                <label>Photo de profil (fichier)</label>
                <input id="photoProfil" type="file" accept="image/*,application/pdf">
              </div>

              <div class="row">
                <label>Sexe</label>
                <select id="sexe">
                  <option value="">-- Choisir --</option>
                  <option>Masculin</option>
                  <option>Féminin</option>
                </select>
              </div>

              <div class="row"><label>Date de naissance</label><input id="dateNaissance" type="date"></div>
              <div class="row"><label>Nationalité</label><input id="nationalite" type="text"></div>

              <div class="row">
                <label>Statut matrimonial</label>
                <select id="statutMatrimonial">
                  <option value="">-- Choisir --</option>
                  <option>Célibataire</option>
                  <option>Marié</option>
                  <option>Divorcé</option>
                  <option>Veuf</option>
                  <option>Pacsé</option>
                </select>
              </div>

              <div class="row"><label>Nombre d’enfants</label><input id="nbEnfants" type="number" min="0" step="1"></div>
              <div class="row"><label>Taille</label><input id="taille" type="number" min="0" step="1"></div>
              <div class="row"><label>Poids</label><input id="poids" type="number" min="0" step="1"></div>

              <div class="row">
                <label>Permis de conduire (fichier)</label>
                <input id="permisFichier" type="file" accept="image/*,application/pdf">
              </div>

              <div class="row">
                <label>Pièce d’identité</label>
                <div class="inline">
                  <select id="typePiece" style="flex:1; min-width:200px;">
                    <option value="">Type de pièce</option>
                    <option>CNI</option>
                    <option>Passeport</option>
                    <option>Permis de conduire</option>
                    <option>Autre</option>
                  </select>
                  <input id="numeroPiece" type="text" placeholder="N° pièce" style="flex:1; min-width:200px;">
                  <input id="pieceFichier" type="file" accept="image/*,application/pdf" style="flex:1; min-width:220px;">
                </div>
              </div>

              <div class="row"><label>N° de téléphone (indicatif)</label><input id="telephone" type="text" placeholder="Ex: +225 ..."></div>

              <div class="note">
                Les fichiers ajoutés doivent être des <b>images</b> ou des <b>PDF</b>.
              </div>
            </div>

            <!-- FORMATION -->
            <div class="tabpanel" id="tab-formation">
              <p class="hint">Ajouter (diplôme / certificat).</p>

              <div class="inline" style="margin:10px 0;">
                <button type="button" class="btn-small" id="btnAddDiplome">+ Ajouter Diplôme</button>
                <button type="button" class="btn-small gray" id="btnAddCertificat">+ Ajouter Certificat</button>
              </div>

              <div id="formationsList"></div>
            </div>

            <!-- EXPERIENCES -->
            <div class="tabpanel" id="tab-experiences">
              <p class="hint">
                Période (Date début / Date fin) : utilisée pour le calcul des années d’expériences.
              </p>

              <div class="inline" style="margin:10px 0;">
                <button type="button" class="btn-small" id="btnAddExperience">+ Ajouter Expérience</button>
              </div>

              <div id="experiencesList"></div>

              <div class="note" id="expTotalNote">
                Total estimé : 0 an(s) d’expérience professionnelle.
              </div>
            </div>

            <!-- LANGUES -->
            <div class="tabpanel" id="tab-langues">
              <div class="row">
                <label>Langue officielle</label>
                <select id="langueOfficielle"></select>
              </div>

              <div class="row">
                <label>2e langue</label>
                <select id="langue2"></select>
              </div>

              <div class="inline" style="margin:10px 0;">
                <button type="button" class="btn-small" id="btnAddLangue">+ Ajouter une langue</button>
              </div>

              <div id="languesPlusList"></div>

              <div class="row">
                <label>À l’aise à l’oral en public ?</label>
                <select id="publicSpeak">
                  <option value="">-- Choisir --</option>
                  <option value="oui">Oui</option>
                  <option value="non">Non</option>
                </select>
              </div>

              <div class="row" id="rowRessenti" style="display:none;">
                <label>Si non, ressenti</label>
                <select id="ressenti">
                  <option value="">-- Choisir --</option>
                  <option>Simple stress</option>
                  <option>Stress + titubation</option>
                  <option>Stress + bégaiement</option>
                </select>
              </div>
            </div>

            <!-- HANDICAP -->
            <div class="tabpanel" id="tab-handicap">
              <div class="row">
                <label>Avez-vous un handicap ?</label>
                <select id="hasHandicap">
                  <option value="">-- Choisir --</option>
                  <option value="non">Non</option>
                  <option value="oui">Oui</option>
                </select>
              </div>

              <div class="row" id="rowHandicapType" style="display:none;">
                <label>Si oui lequel ?</label>
                <select id="handicapType">
                  <option value="">-- Choisir --</option>
                  <option>Moteur</option>
                  <option>Visuel</option>
                  <option>Auditif</option>
                  <option>Parole / langage</option>
                  <option>Psychique</option>
                  <option>Autre</option>
                </select>
              </div>

              <div class="note">
                En cas d’absence dans les listes déroulantes, l’utilisateur pourra faire une requête pour la mise à jour
                (après analyse). Un message lui sera signifié ensuite.
              </div>
            </div>

            <div class="actions">
              <button type="button" class="btn-primary" id="btnSaveAll">Enregistrer</button>
              <div class="msg" id="msgSave" aria-live="polite"></div>
            </div>

          </div>

        </form>
      </div>
    </main>
  </div>

<script>
  // ====== DEMO localStorage ======
  const KEY_ACCOUNT = "talentAccount";   // {email, login, password, createdAt, updatedAt}
  const KEY_SESSION = "talentSession";   // {login, connected, connectedAt}
  const KEY_PROFILE = "talentProfile";   // profil

  const form = document.getElementById("signupForm");

  const emailInput = document.getElementById("email");
  const loginInput = document.getElementById("login");
  const passInput  = document.getElementById("mdp");

  const msg = document.getElementById("msg");
  const msgSave = document.getElementById("msgSave");

  const modeBadge = document.getElementById("modeBadge");
  const btnSubmit = document.getElementById("btnSubmit");
  const btnGoAccount = document.getElementById("btnGoAccount");

  const tagEmail = document.getElementById("tagEmail");
  const tagLogin = document.getElementById("tagLogin");
  const tagMdp   = document.getElementById("tagMdp");

  const rowPwdCreate = document.getElementById("rowPwdCreate");
  const rowPwdModify = document.getElementById("rowPwdModify");
  const btnChangePwd = document.getElementById("btnChangePwd");

  const btnSaveAll = document.getElementById("btnSaveAll");

  // Tabs
  const tabButtons = Array.from(document.querySelectorAll(".tabbtn"));
  const panels = {
    identite: document.getElementById("tab-identite"),
    formation: document.getElementById("tab-formation"),
    experiences: document.getElementById("tab-experiences"),
    langues: document.getElementById("tab-langues"),
    handicap: document.getElementById("tab-handicap")
  };

  // Formation/Exp/Langues dynamiques
  const formationsList = document.getElementById("formationsList");
  const experiencesList = document.getElementById("experiencesList");
  const languesPlusList = document.getElementById("languesPlusList");
  const expTotalNote = document.getElementById("expTotalNote");

  const btnAddDiplome = document.getElementById("btnAddDiplome");
  const btnAddCertificat = document.getElementById("btnAddCertificat");
  const btnAddExperience = document.getElementById("btnAddExperience");
  const btnAddLangue = document.getElementById("btnAddLangue");

  // Langues / Handicap / Ressenti
  const langueOfficielle = document.getElementById("langueOfficielle");
  const langue2 = document.getElementById("langue2");
  const publicSpeak = document.getElementById("publicSpeak");
  const rowRessenti = document.getElementById("rowRessenti");
  const hasHandicap = document.getElementById("hasHandicap");
  const rowHandicapType = document.getElementById("rowHandicapType");

  function setMessage(el, text, type){
    el.textContent = text;
    el.className = "msg " + (type || "");
  }

  function readJSON(key){
    const raw = localStorage.getItem(key);
    if(!raw) return null;
    try { return JSON.parse(raw); } catch(e){ return null; }
  }

  function writeJSON(key, value){
    localStorage.setItem(key, JSON.stringify(value));
  }

  function getAccount(){ return readJSON(KEY_ACCOUNT); }
  function getSession(){ return readJSON(KEY_SESSION); }

  function isConnected(){
    const s = getSession();
    return !!(s && s.connected === true && s.login);
  }

  function isValidEmail(v){
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
  }

  // ===== Tabs behavior =====
  tabButtons.forEach(btn => {
    btn.addEventListener("click", () => {
      tabButtons.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      Object.values(panels).forEach(p => p.classList.remove("active"));
      const key = btn.getAttribute("data-tab");
      if(panels[key]) panels[key].classList.add("active");
    });
  });

  // ===== Mode création/modification =====
  function showCreateMode(){
    modeBadge.textContent = "Mode : Création de compte";
    btnSubmit.textContent = "Créer mon compte";
    btnGoAccount.style.display = "none";

    tagEmail.style.display = "none";
    tagLogin.style.display = "none";
    tagMdp.style.display   = "none";

    emailInput.disabled = false;
    loginInput.disabled = false;

    rowPwdCreate.style.display = "grid";
    rowPwdModify.style.display = "none";
  }

  function showModifyMode(account){
    modeBadge.textContent = "Mode : Modification du profil / Compte";
    btnSubmit.textContent = "Enregistrer (compte)";
    btnGoAccount.style.display = "block";

    // Préremplissage + règles
    emailInput.value = account.email || "";
    loginInput.value = account.login || "";

    // email/login non modifiables
    emailInput.disabled = true;
    loginInput.disabled = true;

    // mot de passe en astérisques + bouton Modifier
    rowPwdCreate.style.display = "none";
    rowPwdModify.style.display = "grid";

    // mention MODIFIER devant infos déjà enregistrées (email/login)
    tagEmail.style.display = "inline-block";
    tagLogin.style.display = "inline-block";
    tagMdp.style.display   = "inline-block";

    setMessage(msg, "Vous êtes connecté(e). Email et login non modifiables. Mot de passe via “Modifier”.", "ok");
  }

  (function init(){
    const acc = getAccount();
    if(isConnected() && acc){
      showModifyMode(acc);
    }else{
      showCreateMode();
    }
  })();

  btnGoAccount.addEventListener("click", () => {
    window.location.href = "profil-talent-compte.html";
  });

  btnChangePwd.addEventListener("click", () => {
    window.location.href = "profil-talent-changer-mdp.html";
  });

  // ===== Soumission partie compte =====
  form.addEventListener("submit", function(e){
    e.preventDefault();

    const acc = getAccount();

    // Création si non connecté
    if(!isConnected()){
      const email = (emailInput.value || "").trim();
      const login = (loginInput.value || "").trim();
      const password = passInput.value || "";

      if(!email || !login || !password){
        setMessage(msg, "Veuillez remplir l’adresse mail, le login et le mot de passe.", "err");
        return;
      }
      if(!isValidEmail(email)){
        setMessage(msg, "Adresse mail invalide.", "err");
        return;
      }
      if(acc){
        setMessage(msg, "Un compte existe déjà sur cet appareil. Veuillez vous connecter.", "err");
        return;
      }

      const newAccount = {
        email, login, password,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      writeJSON(KEY_ACCOUNT, newAccount);
      writeJSON(KEY_SESSION, { login, connected:true, connectedAt: new Date().toISOString() });

      setMessage(msg, "Compte créé avec succès ✅", "ok");
      showModifyMode(newAccount);
      return;
    }

    // Si connecté : email/login non modifiables, mot de passe via page dédiée
    setMessage(msg, "Compte : OK ✅ (Email/Login non modifiables).", "ok");
  });

  // ===== Fichiers : image ou PDF =====
  function fileOk(inputEl){
    if(!inputEl || !inputEl.files || !inputEl.files[0]) return true;
    const f = inputEl.files[0];
    return (f.type.startsWith("image/") || f.type === "application/pdf");
  }

  // ===== FORMATION (ajout diplôme/certificat) =====
  function removeBtn(onClick){
    const b = document.createElement("button");
    b.type = "button";
    b.className = "btn-small gray";
    b.textContent = "Supprimer";
    b.addEventListener("click", onClick);
    return b;
  }

  function createFormationCard(type){
    const card = document.createElement("div");
    card.className = "card";
    card.dataset.type = type;

    const title = document.createElement("div");
    title.style.fontWeight = "900";
    title.style.marginBottom = "10px";
    title.textContent = (type === "diplome") ? "Diplôme" : "Certificat";
    card.appendChild(title);

    // Année d’obtention
    card.appendChild(row("Année d’obtention", inputDate("f-annee")));

    // Diplôme: liste déroulante (seulement si diplôme)
    if(type === "diplome"){
      const sel = document.createElement("select");
      sel.className = "f-diplome";
      ["","BEP","BAC","BTS","DUT/BUT","Licence","Master","Doctorat","Autre"].forEach(v=>{
        const op = document.createElement("option");
        op.value = v;
        op.textContent = v ? v : "-- Choisir --";
        sel.appendChild(op);
      });
      card.appendChild(row("Diplôme", sel));
    }

    // Filière: liste déroulante (simple proposition)
    const filSel = document.createElement("select");
    filSel.className = "f-filiere";
    ["","Finance/Compta","Ressources Humaines","Informatique","BTP","Gestion","Droit","Communication","Autre"].forEach(v=>{
      const op = document.createElement("option");
      op.value = v;
      op.textContent = v ? v : "-- Choisir --";
      filSel.appendChild(op);
    });
    card.appendChild(row("Filière", filSel));

    // N° diplôme
    const num = document.createElement("input");
    num.type = "text";
    num.className = "f-numero";
    card.appendChild(row("N° de diplôme", num));

    // Etablissement / Pays
    card.appendChild(row("Etablissement", inputText("f-etablissement")));
    card.appendChild(row("Pays de l’établissement", inputText("f-pays")));

    // Intitulé exact + fichier
    const intitule = document.createElement("input");
    intitule.type = "text";
    intitule.className = "f-intitule";
    card.appendChild(row(type==="diplome" ? "Intitulé exact sur le Diplôme" : "Intitulé exact sur le Certificat", intitule));

    const f = document.createElement("input");
    f.type = "file";
    f.accept = "image/*,application/pdf";
    f.className = "f-file";
    card.appendChild(row("Ajouter un fichier", f));

    const wrap = document.createElement("div");
    wrap.className = "inline";
    wrap.style.justifyContent = "flex-end";
    wrap.appendChild(removeBtn(()=>card.remove()));
    card.appendChild(wrap);

    return card;
  }

  function row(labelTxt, fieldEl){
    const r = document.createElement("div");
    r.className = "row";
    const lab = document.createElement("label");
    lab.textContent = labelTxt;
    r.appendChild(lab);
    r.appendChild(fieldEl);
    return r;
  }
  function inputText(cls){ const i=document.createElement("input"); i.type="text"; i.className=cls; return i; }
  function inputDate(cls){ const i=document.createElement("input"); i.type="date"; i.className=cls; return i; }

  btnAddDiplome.addEventListener("click", ()=> formationsList.appendChild(createFormationCard("diplome")));
  btnAddCertificat.addEventListener("click", ()=> formationsList.appendChild(createFormationCard("certificat")));

  // ===== EXPERIENCES (ajout) =====
  function createExperienceCard(){
    const card = document.createElement("div");
    card.className = "card";

    const title = document.createElement("div");
    title.style.fontWeight="900";
    title.style.marginBottom="10px";
    title.textContent="Expérience";
    card.appendChild(title);

    // Période (début/fin)
    const start = document.createElement("input");
    start.type="date"; start.className="e-start";
    const end = document.createElement("input");
    end.type="date"; end.className="e-end";

    const periodWrap = document.createElement("div");
    periodWrap.className="inline";
    start.style.flex="1"; end.style.flex="1";
    periodWrap.appendChild(start); periodWrap.appendChild(end);
    card.appendChild(row("Période (début / fin)", periodWrap));

    // Statut (liste déroulante)
    const statut = document.createElement("select");
    statut.className="e-statut";
    ["","Stage","CDD","CDI","Freelance","Intérim","Autre"].forEach(v=>{
      const op=document.createElement("option");
      op.value=v; op.textContent=v? v : "-- Choisir --";
      statut.appendChild(op);
    });
    card.appendChild(row("Statut", statut));

    // Poste
    const poste = document.createElement("input");
    poste.type="text"; poste.className="e-poste";
    card.appendChild(row("Poste", poste));

    // Métier lié au poste (liste déroulante)
    const metier = document.createElement("select");
    metier.className="e-metier";
    ["","Comptable","Assistant(e)","RH","Commercial","BTP - Conducteur travaux","BTP - Ingénieur","Autre"].forEach(v=>{
      const op=document.createElement("option");
      op.value=v; op.textContent=v? v : "-- Choisir --";
      metier.appendChild(op);
    });
    card.appendChild(row("Métier lié au poste", metier));

    // Direction/service (liste déroulante)
    const service = document.createElement("select");
    service.className="e-service";
    ["","Direction générale","Finance/Compta","RH","Commercial","Technique","Administration","Autre"].forEach(v=>{
      const op=document.createElement("option");
      op.value=v; op.textContent=v? v : "-- Choisir --";
      service.appendChild(op);
    });
    card.appendChild(row("Direction / service", service));

    // Secteur activité
    const secteur = document.createElement("input");
    secteur.type="text"; secteur.className="e-secteur";
    card.appendChild(row("Secteur d’activité de l’entreprise", secteur));

    // Diplôme utilisé
    const diplomeU = document.createElement("input");
    diplomeU.type="text"; diplomeU.className="e-diplome";
    card.appendChild(row("Diplôme utilisé", diplomeU));

    const wrap = document.createElement("div");
    wrap.className = "inline";
    wrap.style.justifyContent = "flex-end";
    wrap.appendChild(removeBtn(()=>{ card.remove(); updateTotalExp(); }));
    card.appendChild(wrap);

    start.addEventListener("change", updateTotalExp);
    end.addEventListener("change", updateTotalExp);

    return card;
  }

  btnAddExperience.addEventListener("click", ()=>{
    experiencesList.appendChild(createExperienceCard());
    updateTotalExp();
  });

  function diffDays(s, e){
    const ds = new Date(s), de = new Date(e);
    if(isNaN(ds.getTime()) || isNaN(de.getTime())) return 0;
    const ms = de.getTime() - ds.getTime();
    if(ms <= 0) return 0;
    return Math.floor(ms / (1000*60*60*24));
  }

  function updateTotalExp(){
    const cards = Array.from(experiencesList.querySelectorAll(".card"));
    let totalDays = 0;
    cards.forEach(c=>{
      const s = c.querySelector(".e-start")?.value || "";
      const e = c.querySelector(".e-end")?.value || "";
      totalDays += diffDays(s,e);
    });
    const years = Math.round((totalDays/365)*10)/10;
    expTotalNote.textContent = "Total estimé : " + years + " an(s) d’expérience professionnelle.";
  }

  // ===== LANGUES (listes) =====
  const LANG_OPTIONS = ["","Français","Anglais","Espagnol","Arabe","Portugais","Allemand","Italien","Baoulé","Dioula","Bété","Sénoufo","Autre"];

  function fillLangSelect(sel){
    sel.innerHTML = "";
    LANG_OPTIONS.forEach(v=>{
      const op=document.createElement("option");
      op.value=v;
      op.textContent=v ? v : "-- Choisir --";
      sel.appendChild(op);
    });
  }
  fillLangSelect(langueOfficielle);
  fillLangSelect(langue2);

  btnAddLangue.addEventListener("click", ()=>{
    const card = document.createElement("div");
    card.className="card";
    const wrap = document.createElement("div");
    wrap.className="inline";

    const sel = document.createElement("select");
    sel.className="l-plus";
    fillLangSelect(sel);
    sel.style.flex="1";
    sel.style.minWidth="240px";

    wrap.appendChild(sel);
    wrap.appendChild(removeBtn(()=>card.remove()));
    card.appendChild(wrap);
    languesPlusList.appendChild(card);
  });

  publicSpeak.addEventListener("change", ()=>{
    if(publicSpeak.value === "non"){
      rowRessenti.style.display = "grid";
    }else{
      rowRessenti.style.display = "none";
      document.getElementById("ressenti").value = "";
    }
  });

  hasHandicap.addEventListener("change", ()=>{
    if(hasHandicap.value === "oui"){
      rowHandicapType.style.display = "grid";
    }else{
      rowHandicapType.style.display = "none";
      document.getElementById("handicapType").value = "";
    }
  });

  // ===== ENREGISTRER (tout) + redirection page compte =====
  btnSaveAll.addEventListener("click", ()=>{
    // vérif fichiers image/pdf
    const fileInputs = [
      document.getElementById("photoProfil"),
      document.getElementById("permisFichier"),
      document.getElementById("pieceFichier"),
      ...Array.from(formationsList.querySelectorAll('input[type="file"]'))
    ];

    for(const f of fileInputs){
      if(!fileOk(f)){
        setMessage(msgSave, "Erreur : seuls les fichiers image ou PDF sont acceptés.", "err");
        return;
      }
    }

    // Sauvegarde (démo) : on stocke les valeurs (et seulement le nom des fichiers)
    const profile = {
      identite: {
        nom: v("nom"),
        prenom: v("prenom"),
        posteActuel: v("posteActuel"),
        photoProfil: fileName("photoProfil"),
        sexe: v("sexe"),
        dateNaissance: v("dateNaissance"),
        nationalite: v("nationalite"),
        statutMatrimonial: v("statutMatrimonial"),
        nbEnfants: v("nbEnfants"),
        taille: v("taille"),
        poids: v("poids"),
        permis: fileName("permisFichier"),
        typePiece: v("typePiece"),
        numeroPiece: v("numeroPiece"),
        piece: fileName("pieceFichier"),
        telephone: v("telephone")
      },
      formation: collectFormations(),
      experiences: collectExperiences(),
      langues: {
        langueOfficielle: v("langueOfficielle"),
        langue2: v("langue2"),
        autres: collectLanguesPlus(),
        publicSpeak: v("publicSpeak"),
        ressenti: v("ressenti")
      },
      handicap: {
        hasHandicap: v("hasHandicap"),
        handicapType: v("handicapType")
      },
      totalExperienceYears: totalYears()
    };

    writeJSON(KEY_PROFILE, profile);

    setMessage(msgSave, "Enregistré ✅ Redirection vers la page compte…", "ok");
    window.location.href = "profil-talent-compte.html";
  });

  function v(id){
    const el = document.getElementById(id);
    return el ? (el.value || "").trim() : "";
  }
  function fileName(id){
    const el = document.getElementById(id);
    if(!el || !el.files || !el.files[0]) return "";
    return el.files[0].name;
  }

  function collectFormations(){
    const cards = Array.from(formationsList.querySelectorAll(".card"));
    return cards.map(card=>{
      const type = card.dataset.type || "";
      const annee = card.querySelector(".f-annee")?.value || "";
      const diplome = card.querySelector(".f-diplome")?.value || "";
      const filiere = card.querySelector(".f-filiere")?.value || "";
      const numero = (card.querySelector(".f-numero")?.value || "").trim();
      const etablissement = (card.querySelector(".f-etablissement")?.value || "").trim();
      const pays = (card.querySelector(".f-pays")?.value || "").trim();
      const intitule = (card.querySelector(".f-intitule")?.value || "").trim();
      const fi = card.querySelector(".f-file");
      const fichier = (fi && fi.files && fi.files[0]) ? fi.files[0].name : "";
      return { type, annee, diplome, filiere, numero, etablissement, pays, intitule, fichier };
    });
  }

  function collectExperiences(){
    const cards = Array.from(experiencesList.querySelectorAll(".card"));
    return cards.map(c=>({
      debut: c.querySelector(".e-start")?.value || "",
      fin: c.querySelector(".e-end")?.value || "",
      statut: c.querySelector(".e-statut")?.value || "",
      poste: (c.querySelector(".e-poste")?.value || "").trim(),
      metier: c.querySelector(".e-metier")?.value || "",
      service: c.querySelector(".e-service")?.value || "",
      secteur: (c.querySelector(".e-secteur")?.value || "").trim(),
      diplomeUtilise: (c.querySelector(".e-diplome")?.value || "").trim()
    }));
  }

  function collectLanguesPlus(){
    const sels = Array.from(languesPlusList.querySelectorAll(".l-plus"));
    return sels.map(s=>s.value).filter(x=>x);
  }

  function totalYears(){
    const cards = Array.from(experiencesList.querySelectorAll(".card"));
    let totalDays = 0;
    cards.forEach(c=>{
      const s = c.querySelector(".e-start")?.value || "";
      const e = c.querySelector(".e-end")?.value || "";
      totalDays += diffDays(s,e);
    });
    return Math.round((totalDays/365)*10)/10;
  }
</script>

</body>
</html>
