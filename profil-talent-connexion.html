<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Connexion - Profil Talent</title>

<style>
  *{ box-sizing:border-box; }
  body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#ffffff;
  }

  /* Zone globale comme ta maquette (fond bleu clair) */
  .screen{
    min-height:100vh;
    display:flex;
    background: linear-gradient(to right, #ffffff 0%, #ffffff 30%, #a8c2da 100%);
  }

  /* Menu gauche gris */
  .sidebar{
    width:220px;
    padding:0;
    min-height:100vh;
    display:flex;
    flex-direction:column;
    background:#fff;
  }

  .logo img{
    max-width:220px;
    height:auto;
    display:block;
  }

  .menu{
    background-color:#fff;
    flex:1;
    padding:20px;
    border: 1.5px solid #2f5fa7;  /* encadrement bleu léger */
    border-radius: 10px;          /* coins arrondis */
  }

  .menu a{
    display:block;
    margin:35px 0;
    text-decoration:none;
    color:black;
    font-style:italic;
  }

  .menu a:hover{color:red}

  .menu a.active{
    font-size:22px;
    font-weight:bold;
    color:red;
  }

  .dropdown{position:relative;margin:20px 0;}

  .dropbtn{
    display:block;
    text-decoration:none;
    color:black;
    font-style:italic;
  }

  .dropbtn:hover{color:red;}

  .dropdown-content{
    display:none;
    margin-top:8px;
    margin-left:12px;
    border-left:2px solid #eee;
    padding-left:12px;
  }

  .dropdown-content a{
    display:block;
    margin:10px 0;
    text-decoration:none;
    color:#333;
    font-style:normal;
    font-size:14px;
  }

  .dropdown-content a:hover{color:red;}
  .dropdown:hover .dropdown-content{display:block;}

  /* Zone contenu */
  .content{
    flex:1;
    padding:30px 22px;
  }

  .title{
    text-align:center;
    color:#b71c1c;
    font-size:34px;
    letter-spacing:1px;
    margin:18px 0 35px;
    font-weight:500;
  }

  /* Formulaire centré */
  .form-area{
    max-width:900px;
    margin:0 auto;
    padding-top:10px;
  }

  .row{
    display:grid;
    grid-template-columns: 180px 1fr;
    gap:20px;
    align-items:center;
    margin:22px 0;
  }

  .row label{
    font-size:20px;
    font-weight:600;
    color:#111;
  }

  .row input[type="text"],
  .row input[type="password"]{
    height:45px;
    width:100%;
    border:2px solid #9e9e9e;
    background:#ffffff;
    padding:10px 12px;
    outline:none;
  }

  .register{
    margin-top:8px;
    text-align:right;
    font-size:18px;
    padding-right:10px;
  }
  .register a{
    color:#1565c0;
    text-decoration:underline;
  }

  /* Zone Connexion + Stay (centrée) */
  .actions{
    margin-top:18px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
  }

  .btn-login{
    width:240px;
    height:46px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-size:18px;
    font-weight:700;
    color:#fff;
    background:#2f5fa7;
  }
  .btn-login:hover{ filter:brightness(0.95); }

  .stay{
    display:flex;
    justify-content:center;
    align-items:center;
    gap:10px;
    font-style:italic;
    font-weight:700;
    color:#111;
  }

  /* Mot de passe oublié */
  .forgot{
    margin-top:10px;
    text-align:center;
    font-size:16px;
  }
  .forgot a{
    color:#1565c0;
    text-decoration:underline;
  }

  /* Message feedback */
  .msg{
    margin-top:14px;
    text-align:center;
    font-size:16px;
    font-weight:700;
  }
  .msg.ok{ color:#1b5e20; }
  .msg.err{ color:#b71c1c; }

  /* Box aide mdp */
  .reset-box{
    margin:14px auto 0;
    max-width:520px;
    padding:14px 16px;
    background:#ffffff;
    border:1.5px solid #2f5fa7;
    border-radius:10px;
    display:none;
  }
  .reset-box p{
    margin:0 0 10px;
    font-size:14px;
    line-height:1.35;
  }
  .reset-box input{
    width:100%;
    height:42px;
    border:2px solid #9e9e9e;
    padding:10px 12px;
    outline:none;
  }
  .reset-box button{
    margin-top:10px;
    width:100%;
    height:42px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:700;
    background:#2f5fa7;
    color:#fff;
  }

  /* Responsive */
  @media (max-width: 850px){
    .screen{ flex-direction:column; }
    .sidebar{ width:100%; }
    .row{ grid-template-columns:1fr; }
    .register{ text-align:center; padding-right:0; }
  }
</style>
</head>

<body>
  <div class="screen">

    <!-- MENU GAUCHE -->
    <div class="sidebar">
      <div class="logo">
        <img src="images/LOGO I-JOM.jpg" alt="Logo I-JOM">
      </div>

      <div class="menu">
        <a href="index.html">ACCUEIL</a>
        <a href="apropos.html">A PROPOS DE NOUS</a>

        <!-- PROFIL TALENT (dropdown) -->
        <div class="dropdown">
          <span class="dropbtn active">PROFIL TALENT ▾</span>
          <div class="dropdown-content">
            <a href="profil-talent-connexion.html" class="active">Connexion</a>
            <a href="profil-talent-moncompte.html">Mon Compte</a>
            <a href="profil-talent-inscription.html">Inscription</a>
          </div>
        </div>

        <!-- RECRUTEUR (dropdown) -->
        <div class="dropdown">
          <span class="dropbtn">RECRUTEUR ▾</span>
          <div class="dropdown-content">
            <a href="recruteur-connexion.html">Connexion</a>
            <a href="recruteur-moncompte.html">Mon Compte</a>
            <a href="recruteur-inscription.html">Inscription</a>
          </div>
        </div>

        <a href="partenaires.html">NOS PARTENAIRES</a>
        <a href="contact.html">NOUS CONTACTER</a>
      </div>
    </div>

    <!-- CONTENU -->
    <main class="content">
      <div class="title">CONNEXION PROFIL TALENT</div>

      <div class="form-area">
        <form id="loginForm" action="#" method="post" novalidate>
          <div class="row">
            <label for="login">Login</label>
            <input id="login" name="login" type="text" autocomplete="username" required>
          </div>

          <div class="row">
            <label for="mdp">Mot de passe</label>
            <input id="mdp" name="password" type="password" autocomplete="current-password" required>
          </div>

          <div class="register">
            Pas encore inscrit? <a href="profil-talent-inscription.html">Cliquez ici</a>
          </div>

          <!-- ✅ Bouton Connexion juste avant Restez connecté -->
          <div class="actions">
            <button type="submit" class="btn-login" id="btnLogin">Connexion</button>

            <div class="stay">
              <input type="checkbox" id="stayConnected" name="stayConnected">
              <label for="stayConnected">Restez connecté(e)</label>
            </div>

            <div class="forgot">
              <a href="#" id="forgotLink">Mot de passe oublié ?</a>
            </div>

            <div class="msg" id="msg" aria-live="polite"></div>
          </div>

          <!-- Petit bloc “mot de passe oublié” -->
          <div class="reset-box" id="resetBox">
            <p>Entrez votre email. (Démo) On affichera un message comme si un lien de réinitialisation avait été envoyé.</p>
            <input type="email" id="resetEmail" placeholder="Votre email">
            <button type="button" id="resetBtn">Envoyer le lien</button>
            <div class="msg" id="resetMsg" aria-live="polite"></div>
          </div>
        </form>
      </div>
    </main>

  </div>

<script>
  // =========================
  //  Connexion Profil Talent (LOCAL)
  //  - lit talentAccount (créé à l'inscription)
  //  - crée talentSession (pour accéder au compte)
  //  - 3 tentatives max
  // =========================

  const KEY_ACCOUNT = "talentAccount";
  const KEY_SESSION = "talentSession";
  const KEY_ATTEMPTS = "talentLoginAttempts";
  const KEY_REMEMBER = "talentRememberedLogin";

  const MAX_ATTEMPTS = 3;

  const form = document.getElementById("loginForm");
  const loginInput = document.getElementById("login");
  const passInput = document.getElementById("mdp");
  const stayConnected = document.getElementById("stayConnected");
  const msg = document.getElementById("msg");
  const btnLogin = document.getElementById("btnLogin");

  const forgotLink = document.getElementById("forgotLink");
  const resetBox = document.getElementById("resetBox");
  const resetBtn = document.getElementById("resetBtn");
  const resetEmail = document.getElementById("resetEmail");
  const resetMsg = document.getElementById("resetMsg");

  function readJSON(key){
    const raw = localStorage.getItem(key);
    if(!raw) return null;
    try { return JSON.parse(raw); } catch(e){ return null; }
  }

  function setMessage(text, type){
    msg.textContent = text;
    msg.className = "msg " + (type || "");
  }

  function lockForm(){
    loginInput.disabled = true;
    passInput.disabled = true;
    stayConnected.disabled = true;
    btnLogin.disabled = true;
  }

  function remainingAttempts(attempts){
    return MAX_ATTEMPTS - attempts;
  }

  // Auto-remplissage si "restez connecté"
  (function preload(){
    const saved = localStorage.getItem(KEY_REMEMBER);
    if(saved){
      loginInput.value = saved;
      stayConnected.checked = true;
    }
  })();

  // Si une session existe déjà, aller au compte
  (function autoRedirectIfConnected(){
    const session = readJSON(KEY_SESSION);
    if(session && session.connected === true){
      window.location.href = "profil-talent-compte.html";
    }
  })();

  // Compteur tentatives (sessionStorage pour reset au refresh navigateur)
  let attempts = Number(sessionStorage.getItem(KEY_ATTEMPTS) || "0");

  form.addEventListener("submit", function(e){
    e.preventDefault();

    if(attempts >= MAX_ATTEMPTS){
      setMessage("Trop de tentatives. Veuillez réessayer plus tard.", "err");
      lockForm();
      return;
    }

    const login = (loginInput.value || "").trim();
    const password = passInput.value || "";

    if(!login || !password){
      setMessage("Veuillez remplir le login et le mot de passe.", "err");
      return;
    }

    const account = readJSON(KEY_ACCOUNT);

    if(!account || !account.login || !account.password){
      setMessage("Aucun compte trouvé. Veuillez vous inscrire d'abord.", "err");
      return;
    }

    const ok = (login === account.login && password === account.password);

    if(ok){
      // Restez connecté: mémoriser uniquement le login
      if(stayConnected.checked){
        localStorage.setItem(KEY_REMEMBER, login);
      }else{
        localStorage.removeItem(KEY_REMEMBER);
      }

      // Créer session
      localStorage.setItem(KEY_SESSION, JSON.stringify({
        login: account.login,
        connected: true,
        connectedAt: new Date().toISOString()
      }));

      // reset tentatives
      attempts = 0;
      sessionStorage.setItem(KEY_ATTEMPTS, "0");

      setMessage("Connexion réussie. Redirection…", "ok");
      window.location.href = "profil-talent-compte.html";
      return;
    }

    // Faux identifiants
    attempts += 1;
    sessionStorage.setItem(KEY_ATTEMPTS, String(attempts));

    const restants = remainingAttempts(attempts);

    if(restants > 0){
      setMessage("Identifiants incorrects. Il vous reste " + restants + " tentative(s).", "err");
      passInput.value = "";
      passInput.focus();
    }else{
      setMessage("Identifiants incorrects. Trop de tentatives. Accès temporairement bloqué.", "err");
      lockForm();
    }
  });

  // Mot de passe oublié (démo)
  forgotLink.addEventListener("click", function(e){
    e.preventDefault();
    resetMsg.textContent = "";
    resetMsg.className = "msg";
    resetBox.style.display = (resetBox.style.display === "block") ? "none" : "block";
    if(resetBox.style.display === "block") resetEmail.focus();
  });

  resetBtn.addEventListener("click", function(){
    const email = (resetEmail.value || "").trim();
    if(!email){
      resetMsg.textContent = "Veuillez entrer votre email.";
      resetMsg.className = "msg err";
      return;
    }
    resetMsg.textContent = "Si cet email existe, un lien de réinitialisation a été envoyé.";
    resetMsg.className = "msg ok";
    resetEmail.value = "";
  });
</script>
